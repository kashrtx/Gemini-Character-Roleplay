<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Gemini Custom Character RolePlay</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#9333EA',
                        accent: '#F97316',
                        background: '#F9FAFB',
                        'message-user': '#E5E7EB',
                        'message-character': '#D1D5DB',
                    },
                    borderRadius: {
                        'message': '1.5rem',
                    }
                }
            }
        }
    </script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts - Apple-like font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <!-- Custom styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-background font-['Inter',sans-serif] text-gray-900 antialiased">
    <div id="app" class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-primary text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-xl font-bold">Google Gemini Custom Character RolePlay</h1>
                <nav class="flex space-x-4">
                    <button 
                        onclick="changeView('chat')"
                        id="chat-btn"
                        class="px-3 py-1 rounded bg-white text-primary"
                    >
                        <i class="fas fa-comments mr-1"></i> Chat
                    </button>
                    <button 
                        onclick="changeView('characters')"
                        id="characters-btn"
                        class="px-3 py-1 rounded text-white"
                    >
                        <i class="fas fa-user-circle mr-1"></i> Characters
                    </button>
                    <button 
                        onclick="changeView('settings')"
                        id="settings-btn"
                        class="px-3 py-1 rounded text-white"
                    >
                        <i class="fas fa-cog mr-1"></i> Settings
                        <span id="api-warning" class="ml-1 text-red-300 hidden">*</span>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Error Message -->
        <div id="error-container" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 m-4 rounded shadow-md hidden">
            <div class="flex">
                <div class="py-1"><i class="fas fa-exclamation-circle"></i></div>
                <div class="ml-3">
                    <p id="error-message"></p>
                    <button 
                        onclick="dismissError()"
                        class="text-sm font-semibold mt-1"
                    >
                        Dismiss
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-grow flex overflow-hidden">
            <!-- Settings View -->
            <div id="settings-view" class="w-full hidden">
                <div class="container mx-auto p-6 max-w-2xl">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-6 text-gray-800">Settings</h2>
                        
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold mb-3 text-gray-700">Google Gemini API Key</h3>
                            <p class="mb-4 text-gray-600">
                                Your API key is stored locally in your browser and is only sent to Google's servers when making API calls.
                            </p>
                            <div class="flex">
                                <input
                                    type="password"
                                    id="api-key-input"
                                    placeholder="Enter your Google Gemini API key"
                                    class="flex-grow p-2 border rounded-l focus:outline-none focus:ring-2 focus:ring-primary"
                                />
                                <button
                                    onclick="saveApiKey()"
                                    class="bg-primary text-white px-4 py-2 rounded-r hover:bg-primary/90 transition"
                                >
                                    Save
                                </button>
                            </div>
                            <p id="api-saved" class="text-green-600 mt-2 hidden">
                                <i class="fas fa-check-circle mr-1"></i> API key saved successfully
                            </p>
                            <p class="mt-2 text-sm text-gray-500">
                                <i class="fas fa-info-circle mr-1"></i> Get your Gemini API key from <a href="https://aistudio.google.com/" target="_blank" rel="noopener noreferrer" class="text-primary underline">Google AI Studio</a>
                            </p>
                        </div>
                        
                        <div class="mb-8 border-t pt-6">
                            <h3 class="text-lg font-semibold mb-3 text-gray-700">Chat Settings</h3>
                            <div class="flex items-center mb-4">
                                <input 
                                    type="checkbox" 
                                    id="allow-group-chats" 
                                    class="mr-2 h-5 w-5 accent-primary"
                                    onclick="toggleGroupChats(this.checked)"
                                >
                                <label for="allow-group-chats" class="text-gray-600">
                                    Allow multiple character selection (Group chats)
                                </label>
                            </div>
                            <p class="text-sm text-gray-500 mb-4">
                                <i class="fas fa-info-circle mr-1"></i> When disabled, only one character can be selected at a time for chat.
                            </p>
                        </div>
                        
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold mb-3 text-gray-700">About</h3>
                            <p class="text-gray-600">
                                This application uses the Google Gemini API to power character interactions. 
                                All data is stored locally in your browser. No information is sent to any server 
                                other than directly to Google's API. Uses Gemini 2.0 Flash for quick and witted responses!
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Characters View -->
            <div id="characters-view" class="w-full hidden">
                <div class="container mx-auto p-6 max-w-4xl">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Create Character -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-bold mb-6 text-gray-800">Create New Character</h2>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Character Name</label>
                                <input
                                    type="text"
                                    id="character-name"
                                    placeholder="e.g., Sherlock Holmes"
                                    class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-primary"
                                />
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">Character Context</label>
                                <textarea
                                    id="character-context"
                                    placeholder="Describe the character (e.g., Sherlock Holmes, a brilliant detective from Victorian London)"
                                    rows="5"
                                    class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-primary resize-y overflow-auto max-h-60"
                                ></textarea>
                            </div>
                            
                            <button
                                id="create-character-btn"
                                class="bg-primary text-white px-4 py-2 rounded hover:bg-primary/90 transition disabled:bg-gray-400"
                            >
                                Create Character
                            </button>
                        </div>
                        
                        <!-- Character List -->
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-bold mb-6 text-gray-800">Your Characters</h2>
                            
                            <div id="character-list" class="space-y-4">
                                <p id="no-characters" class="text-gray-500 italic">No characters created yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat View -->
            <div id="chat-view" class="w-full flex h-full">
                <!-- Character Sidebar -->
                <div id="character-sidebar" class="w-64 bg-white border-r flex flex-col h-full transition-all duration-300 ease-in-out lg:translate-x-0">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h2 class="font-bold text-gray-800">Select Characters</h2>
                        <button
                            id="toggle-sidebar-btn"
                            class="text-gray-600 hover:text-primary lg:hidden"
                            aria-label="Toggle Character Menu"
                        >
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div id="sidebar-characters" class="flex-grow overflow-y-auto">
                        <p class="text-gray-500 italic p-4 text-sm">
                            No characters created yet. Go to Characters tab to create some.
                        </p>
                    </div>
                </div>

                <div id="chat-placeholder" class="flex-grow flex items-center justify-center bg-gray-50 p-4">
                    <button
                        id="show-characters-btn"
                        class="text-gray-600 hover:text-primary absolute top-4 left-4 lg:hidden"
                        aria-label="Show Characters"
                    >
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="text-center">
                        <i class="fas fa-comments text-5xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Select one or more characters to start chatting</p>
                    </div>
                </div>

                <div id="chat-window" class="flex-grow flex flex-col bg-gray-50 hidden">
                    <!-- Chat header -->
                    <div class="p-4 bg-white border-b flex justify-between items-center shadow-sm">
                        <div class="flex items-center space-x-4">
                            <button
                                id="show-chat-sidebar-btn"
                                class="text-gray-600 hover:text-primary lg:hidden"
                                aria-label="Show Characters"
                            >
                                <i class="fas fa-bars"></i>
                            </button>
                            <div>
                                <h2 id="chat-header-title" class="font-bold text-gray-800">Character Name</h2>
                                <p id="chat-header-subtitle" class="text-sm text-gray-500">Private conversation</p>
                            </div>
                        </div>
                        <button
                            onclick="clearChatMessages()"
                            class="text-red-500 hover:text-red-700 px-2 py-1 rounded"
                            title="Clear chat"
                        >
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    
                    <!-- Chat messages -->
                    <div id="chat-messages" class="flex-grow overflow-y-auto p-4 chat-window">
                        <div class="text-center text-gray-500 mt-8">
                            <p>No messages yet. Start the conversation!</p>
                        </div>
                    </div>
                    
                    <!-- Message input -->
                    <div class="p-4 bg-white border-t">
                        <form id="chat-form" class="flex space-x-2">
                            <input
                                type="text"
                                id="message-input"
                                placeholder="Type your message..."
                                class="flex-grow p-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-primary"
                            />
                            <button
                                type="submit"
                                id="send-message-btn"
                                class="bg-primary text-white p-3 w-12 rounded-full hover:bg-primary/90 transition disabled:bg-gray-400"
                            >
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Load Gemini SDK -->
    <script>
        // Initialize global variable for debugging
        window.debugApp = false;
        
        // Optional debugging function for console
        function toggleDebug() {
            window.debugApp = !window.debugApp;
            console.log("Debug mode:", window.debugApp ? "ON" : "OFF");
            return "Debug mode " + (window.debugApp ? "enabled" : "disabled");
        }
    </script>
    
    <script src="script.js"></script>
</body>
</html>
